---
title: "GASã§è­°äº‹éŒ²ã®ãƒ†ãƒ³ãƒ—ãƒ¬ä½œæˆã¨å‘¨çŸ¥ã‚’è‡ªå‹•åŒ–ã™ã‚‹"
date: "2020-06-20T00:01:00.000Z"
updatedAt: ""
template: "post"
draft: false
slug: "/posts/copy-google-document-weekly"
category: "Snippet"
tags:
    - "Google Apps Script"
description: "GASã‚’ä½¿ã£ã¦å…ˆé€±ã®è­°äº‹éŒ²ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä»Šé€±ã®è­°äº‹éŒ²ã¨ã—ã¦ä½¿ã„å›ã™æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚"
socialImage: "/media/2020/6/20/2020_6_20__0.jpg"
---

![æ›¸é¡ã®å±±](/media/2020/6/20/2020_6_20__0.jpg)

Photo by [Sharon McCutcheon](https://unsplash.com/@sharonmccutcheon?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

## Google Apps Scriptã§è­°äº‹éŒ²ä½œæˆã‚’è‡ªå‹•åŒ–ã™ã‚‹
ã“ã®è¨˜äº‹ã§ã¯ã€Google Apps Scriptï¼ˆä»¥ä¸‹ã€GASï¼‰ã‚’ä½¿ã£ã¦æ¯é€±ã®è­°äº‹éŒ²ä½œæˆã‚’è‡ªå‹•åŒ–ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

Google Driveã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹Google Documentã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è§£èª¬ã—ãŸå¾Œã€ç¥æ—¥ã¯å®Ÿè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¨Slackã«é€šçŸ¥ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ²è¼‰ã—ã¾ã™ã€‚

é–¢é€£è¨˜äº‹

- [Google Apps Scirptã‹ã‚‰Slackã¨LINEã¨é€£æºã™ã‚‹botã‚’ä½œã‚‹æ‰‹é †ã‚’ç´¹ä»‹ã—ã¾ã™](/posts/google-apps-script-api-templates)
- [GASã§æ—¥æœ¬ã®ä¼‘æ—¥ãƒ»ç¥æ—¥ã‚’åˆ¤å®šã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ï¼ˆGoogle Apps Script)](/posts/judge-holiday-in-japan-by-google-apps-script)

## GASã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
GASã§ãƒ•ã‚©ãƒ«ãƒ€ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†ã«ã¯[DriveApp](https://developers.google.com/apps-script/reference/drive/drive-app)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

ä»Šå›ã¯Google Document`20200613_ğŸ¼ãƒãƒ¼ãƒ _è­°äº‹éŒ²`ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€`20200620_ğŸ¼ãƒãƒ¼ãƒ _è­°äº‹éŒ²`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ä½œæˆã™ã‚‹ã¨ã„ã†ã‚·ãƒ¼ãƒ³ã‚’æƒ³å®šã—ã¾ã™ã€‚

Google Driveã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹GASã®ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã§ã™ã€‚

``` js
const FOLDER_ID = 'XXXXXXXXXXXXXXXX'

function copy() {
  // 1. ã‚³ãƒ”ãƒ¼å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã™ã‚‹
  const folder = DriveApp.getFolderById(FOLDER_ID)

  // 2. ãƒ•ã‚¡ã‚¤ãƒ«åã¯æ•°å€¤ã®é™é †ãªã®ã§ã€
  // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å…ˆé ­ã®ã‚‚ã®ãŒæœ€æ–°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚‹
  const files = folder.getFiles()
  const file = files.next()

  // 3. æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«åã‚’çµ„ã¿ç«‹ã¦ã‚‹
  const date = Utilities.formatDate(new Date(), 'Asia/Tokyo', 'yyyyMMdd')
  const name = `${date}_ğŸ¼ãƒãƒ¼ãƒ _è­°äº‹éŒ²`

  return file.makeCopy(name, folder)
}
```

`FOLDER_ID`ã¯ã€ã‚³ãƒ”ãƒ¼ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã®IDã§ã™ã€‚`https://drive.google.com/drive/folders/XXXXXXXXXXXXXXXX`ã®ã‚ˆã†ã«ã€ãƒ•ã‚©ãƒ«ãƒ€ã®IDã¯URLå†…ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä»¥ä¸‹ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰ã—ã¦ã„ã‚‹ç®‡æ‰€ã®è§£èª¬ã‚’ã—ã¾ã™ã€‚

### ã‚³ãƒ”ãƒ¼å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã™ã‚‹
DriveAppã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®[getFolderById(id)](https://developers.google.com/apps-script/reference/drive/drive-app#getFolderById(String))ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ•ã‚©ãƒ«ãƒ€ã‚’å–å¾—ã—ã¾ã™ã€‚

**è¿”ã‚Šå€¤ã¯Folderã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚**æ¬¡ã«Folderã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ã£ã¦ã€ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ã«å­˜åœ¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¨ã¦å–å¾—ã—ã¾ã™ã€‚

### ãƒ•ã‚©ãƒ«ãƒ€ã«å­˜åœ¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‹ã‚‰ç›®çš„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã™ã‚‹
[Folder](https://developers.google.com/apps-script/reference/drive/folder)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®[getFiles()](https://developers.google.com/apps-script/reference/drive/folder#getfiles)ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¾ã™ã€‚

**è¿”ã‚Šå€¤ã¯[FileIterator](https://developers.google.com/apps-script/reference/drive/file-iterator)ã¨ã„ã†ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã§ã™ã€‚**ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ä¸­ã«ã¯Fileã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå…¥ã£ã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã€ãƒ•ã‚©ãƒ«ãƒ€ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js
const files = DriveApp.getFiles();
while (files.hasNext()) {
  const file = files.next();
  Logger.log(file.getName());
}
```

**Fileã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ•°å€¤ã®é™é †ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«åã®å…ˆé ­ã«æ—¥ä»˜ã‚’å…¥ã‚Œã¦ãŠãã¨ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å…ˆé ­ã«å‰å›ã®è­°äº‹éŒ²ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå…¥ã‚Šã¾ã™ã€‚**

ã“ã®ãŸã‚ã€ä»Šå›ã¯`files.next()`ã‚’ä¸€åº¦å®Ÿè¡Œã™ã‚‹ã ã‘ã§å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã§ãã¾ã™ã€‚

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«åã‚’çµ„ã¿ç«‹ã¦ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹
æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«åã¯`20200620_ğŸ¼ãƒãƒ¼ãƒ _è­°äº‹éŒ²`ã«ã—ã¾ã™ã€‚

ä¼šè­°å½“æ—¥ã®æ—¥ä»˜ãŒå…¥ã‚‹ãŸã‚ã€GASã®ä¾¿åˆ©ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ[Utilities](https://developers.google.com/apps-script/reference/utilities/utilities)ã®`formatDate`ã‚’ä½¿ã£ã¦æ—¥ä»˜ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚

ãã—ã¦ã€`file`ã®`makeCopy`ã§ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ç¬¬äºŒå¼•æ•°ã«ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã—ã¾ã™ã€‚

## å®Ÿå‹™ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã™ã‚‹
ã“ã‚Œã§Google Driveã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã§ãã¾ã—ãŸã€‚ã•ã‚‰ã«ä½œæˆã—ãŸè­°äº‹éŒ²ã‚’Slackã«é€šçŸ¥ã™ã‚‹æ©Ÿèƒ½ã¨ã€ç¥æ—¥ãªã‚‰è­°äº‹éŒ²ã‚’ä½œæˆã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

### ã‚³ãƒ”ãƒ¼ã—ãŸè­°äº‹éŒ²ã®URLã‚’Slackã«é€šçŸ¥ã™ã‚‹
ä½œæˆã—ãŸè­°äº‹éŒ²ã®URLã‚’Slackã®ãƒãƒ£ãƒ³ãƒãƒ«ã«æŠ•ç¨¿ã—ã¾ã—ã‚‡ã†ã€‚

```js
const SLACK_WEBHOOK_URL = PropertiesService
    .getScriptProperties()
    .getProperty('SLACK_WEBHOOK_URL')

function send(url) {
  const text = `ä»Šæ—¥ã®è­°äº‹éŒ²äºˆå®šåœ°ã§ã™
${url}`

  const data = {
    "username" : 'Panda User',
    "icon_emoji": ':panda_face:',
    text,
  };

  const params = {
    "method": "POST",
    "contentType": "application/json",
    "payload": JSON.stringify(data),
  };

  UrlFetchApp.fetch(SLACK_WEBHOOK_URL, params)
}
```

[Slackã®ãƒãƒ£ãƒ³ãƒãƒ«ã«å¯¾ã—ã¦ç™ºè¡Œã•ã‚Œã‚‹WEBHOOK URLã¯GASã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«æ ¼ç´ã—ã¾ã—ã‚‡ã†ã€‚](/posts/google-apps-script-api-templates#gasã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å€¤ã‚’ä¿å­˜ã™ã‚‹)GASã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ç’°å¢ƒå¤‰æ•°ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚WEBHOOK URLã¯å¤–ã«æ¼ã‚Œãªã„ã‚ˆã†ã«ç®¡ç†ã—ã¾ã—ã‚‡ã†ã€‚

### GASã§ç¥æ—¥ã®åˆ¤å®šã‚’ã—ã¦ã€ç¥æ—¥ãªã‚‰è­°äº‹éŒ²ã‚’ä½œæˆã—ãªã„
ç¥æ—¥åˆ¤å®šã«ã¯ã€`CalendarApp`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ã„ã¾ã™ã€‚

```js
function isHoliday() {
  const today = new Date();
  const calendars = CalendarApp.getCalendarsByName('æ—¥æœ¬ã®ç¥æ—¥');
  const count = calendars[0].getEventsForDay(today).length;
  return count > 0;
}
```

ç¥æ—¥ã‚’åˆ¤å®šã™ã‚‹ä»•çµ„ã¿ã¯ä¸‹è¨˜ã®è¨˜äº‹ã§è©³ã—ãè§£èª¬ã—ã¦ã„ã¾ã™ã€‚

[GASã§æ—¥æœ¬ã®ä¼‘æ—¥ãƒ»ç¥æ—¥ã‚’åˆ¤å®šã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ï¼ˆGoogle Apps Script)](/posts/judge-holiday-in-japan-by-google-apps-script)

### é€±æ¬¡å®Ÿè¡Œã®ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã™ã‚‹
æ¬¡ã¯ã€è­°äº‹éŒ²ã®ä½œæˆã‚’é€±æ¬¡ã§å®Ÿè¡Œã™ã‚‹è¨­å®šã‚’ã—ã¾ã—ã‚‡ã†ã€‚**GASã§ã¯ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€æ¯é€±è‡ªå‹•ã§é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**

ãƒˆãƒªã‚¬ãƒ¼ã¯é–¢æ•°å˜ä½ã§æŒ‡å®šã§ãã‚‹ã®ã§ã€[ã‚³ãƒ¼ãƒ‰å…¨æ–‡ã«è¨˜è¼‰ã—ã¦ã„ã‚‹mainé–¢æ•°ã‚’æŒ‡å®šã—ã¾ã™ã€‚](/posts/copy-google-document-weekly/#ã‚³ãƒ¼ãƒ‰å…¨æ–‡ã‚’è¨˜è¼‰ã—ã¾ã™)

GASã®ãƒˆãƒªã‚¬ãƒ¼ã®è¨­å®šæ–¹æ³•ã¯ã€[ã€ŒGoogle Apps Scirptã‹ã‚‰Slackã¨LINEã¨é€£æºã™ã‚‹botã‚’ä½œã‚‹æ‰‹é †ã‚’ç´¹ä»‹ã—ã¾ã™ã€](/posts/google-apps-script-api-templates#ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã™ã‚‹)ã¨ã„ã†è¨˜äº‹ã§è§£èª¬ã—ã¦ã„ã¾ã™ã€‚

## ã¾ã¨ã‚
ã“ã‚Œã§è­°äº‹éŒ²ã‚’è‡ªå‹•ã§Slackã«æŠ•ç¨¿ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼

![Slackã¸ã®æŠ•ç¨¿](/media/2020/6/20/2020_6_20__1.png)

**ä»Šå›ã¯æ—¥å¸¸ã«æ½œã‚€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãƒ¯ãƒ¼ã‚¯ã®ä¸€ã¤ã€è­°äº‹éŒ²ã®é€±æ¬¡ã®ä½œæˆã‚’ç„¡ãã™ãŸã‚ã®GASã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚**

[ã€Œãƒ—ãƒ­ã‚°ãƒ©ãƒãŒçŸ¥ã‚‹ã¹ã97ã®ã“ã¨ã€](https://amzn.to/2V1nYyd)ã¨ã„ã†æœ¬ã«ã€Œé¢å€’ã§ã‚‚è‡ªå‹•åŒ–ã§ãã‚‹ã“ã¨ã¯è‡ªå‹•åŒ–ã™ã‚‹ã€ã¨ã„ã†ç« ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ç« ã§èª¬ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãƒ¯ãƒ¼ã‚¯ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§è‡ªå‹•åŒ–ã—ã¦ã€ä¾¡å€¤ã‚’ç”Ÿã‚€æ´»å‹•ã®ãŸã‚ã«æ™‚é–“ã‚’ç¯€ç´„ã—ã¾ã—ã‚‡ã†ï¼

## ã‚³ãƒ¼ãƒ‰å…¨æ–‡ã‚’è¨˜è¼‰ã—ã¾ã™
ä»¥ä¸‹ã«ä»Šå›ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã®å…¨æ–‡ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

```js
const FOLDER_ID = 'XXXXXXXXXXXXXXXX'
const SLACK_WEBHOOK_URL = PropertiesService
  .getScriptProperties()
  .getProperty('SLACK_WEBHOOK_URL')

function main() {
  if (isHoliday()) {
    return
  }

  const file = copy()
  const url = file.getUrl()

  send(url)
}

function isHoliday() {
  const today = new Date();
  const calendars = CalendarApp.getCalendarsByName('æ—¥æœ¬ã®ç¥æ—¥');
  const count = calendars[0].getEventsForDay(today).length;
  return count > 0;
}

function copy() {
  const folder = DriveApp.getFolderById(FOLDER_ID)
  const files = folder.getFiles()
  const file = files.next()

  // æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«åã‚’çµ„ã¿ç«‹ã¦ã‚‹
  const date = Utilities.formatDate(new Date(), 'Asia/Tokyo', 'yyyyMMdd')
  const name = `${date}_ğŸ¼ãƒãƒ¼ãƒ _è­°äº‹éŒ²`

  return file.makeCopy(name, folder)
}

function send(url) {
  const data = {
    "username": 'panda user',
    "icon_emoji": ':panda-face:',
    "text": `ä»Šæ—¥ã®è­°äº‹éŒ²äºˆå®šåœ°ã§ã™
${url}`,
  };
  const params = {
    "method": "post",
    "contentType": "application/json",
    "payload": JSON.stringify(data),
  };

  UrlFetchApp.fetch(SLACK_WEBHOOK_URL, params)
}
```
