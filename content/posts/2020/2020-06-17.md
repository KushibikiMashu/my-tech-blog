---
title: "Google Apps Scirptã‹ã‚‰Slackã¨LINEã«é€šçŸ¥ã‚’é€ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™"
date: "2020-06-17T16:52:00.000Z"
updatedAt: ""
template: "post"
draft: false
slug: "/posts/google-apps-script-api-templates"
category: "Template"
tags:
    - "Google Apps Script"
description: "Google Apps Scriptã§Slackã‚„LINEã«é€šçŸ¥ã‚’é€ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé›†ã‚’ç´¹ä»‹ã—ã¾ã™"
socialImage: "/media/2020/6/17/2020_6_17__0.png"
---

![Google Apps Scriptã®ã‚¨ãƒ‡ã‚£ã‚¿](/media/2020/6/17/2020_6_17__0.png)

## Google Apps Scriptã‹ã‚‰Slackã‚„LINEã«é€šçŸ¥ã‚’é€ã‚‹
ã“ã®è¨˜äº‹ã¯ã€Google Apps Scriptã‹ã‚‰Slackã‚„LINEã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ã¾ãŸã€Google Apps Scriptã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ”ãƒ¼ã—ã¦ãã®ã¾ã¾ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

é–¢é€£è¨˜äº‹: [GASã§æ—¥æœ¬ã®ä¼‘æ—¥ãƒ»ç¥æ—¥ã‚’åˆ¤å®šã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ï¼ˆGoogle Apps Script)](/posts/judge-holiday-in-japan-by-google-apps-script)


## Slackã®ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã™ã‚‹
Slackã®ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã™ã‚‹å ´åˆã¯ã€Incoming Webhookã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

### Slackã®Incoming Webhookã«ç™»éŒ²ã™ã‚‹
![Slackã®Incoming Webhook](/media/2020/6/17/2020_6_17__1.png)

ã€ŒSlackã«è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€æŠ•ç¨¿ã™ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚

ãã®å¾Œã€Webhook URLãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã“ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚ã“ã‚ŒãŒPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

![Slackã®Incoming Webhook URL](/media/2020/6/17/2020_6_17__2.png)

æœ€ä¸‹éƒ¨ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€ã€Œè¨­å®šã‚’ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

### Google Apps Scriptã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«Webhook URLã‚’ä¿å­˜ã™ã‚‹
Webhook URLã‚’çŸ¥ã£ã¦ã„ã‚‹ã¨èª°ã§ã‚‚ãƒãƒ£ãƒ³ãƒãƒ«ã«æŠ•ç¨¿ã§ãã¦ã—ã¾ã†ã®ã§ã€å¤–ã«æ¼ã‚Œãªã„ã‚ˆã†ã«Google Apps Scriptã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç™»éŒ²ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

Google Apps Scriptã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ç’°å¢ƒå¤‰æ•°ã®ã‚ˆã†ãªã‚‚ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ªãƒ¼ãƒŠãƒ¼ã—ã‹é–²è¦§ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

Google Apps Scriptã‹ã‚‰ã€[ãƒ•ã‚¡ã‚¤ãƒ« > ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ > ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£]ã‚’é–‹ãã¾ã™ã€‚

![Google Apps Script](/media/2020/6/17/2020_6_17__3.png)

ã€Œè¡Œã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Key/Valueã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

![Google Apps Scriptã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£](/media/2020/6/17/2020_6_17__4.png)

ã“ã“ã§ã¯ã€`SLACK_CHANNEL_URL`ã‚’ã‚­ãƒ¼ã«ã—ã¦ã„ã¾ã™ã€‚

### Google Apps Scriptã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç™»éŒ²ã—ãŸå€¤ã¯ã€[PropertiesService](https://developers.google.com/apps-script/reference/properties/properties-service)ã‚’ä½¿ã£ã¦å–å¾—ã—ã¾ã™ã€‚

```js
const SLACK_CHANNEL_URL = PropertiesService
    .getScriptProperties()
    .getProperty('SLACK_CHANNEL_URL')

function send() {
  // æŠ•ç¨¿ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  const text = 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã¾ã™'

  // æŠ•ç¨¿è€…åã¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®šã™ã‚‹
  const data = {
     "username" : 'Slack Panda',
     "icon_emoji": ':panda_face:',
     text,
  };

  const params = {
    "method" : "POST",
    "contentType" : "application/json",
    "payload" : JSON.stringify(data),
  };

  UrlFetchApp.fetch(SLACK_CHANNEL_URL, params)
}
```

GASã«çµ„ã¿è¾¼ã¿ã®[UrlFetchAppã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app)ã‚’ä½¿ã£ã¦Slackã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã¾ã™ã€‚

[å®Ÿè¡Œ > é–¢æ•°ã‚’å®Ÿè¡Œ > send]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![Google Apps Scriptã®é–¢æ•°å®Ÿè¡Œ](/media/2020/6/17/2020_6_17__5.png)

Slackã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã§ãã¾ã—ãŸ ğŸ‰

![Slackã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸](/media/2020/6/17/2020_6_17__6.png)

ã‚ã¨ã¯ã€JavaScriptã§æŠ•ç¨¿ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¥½ããªã‚ˆã†ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã—ã‚‡ã†ï¼

## LINEã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã™ã‚‹
æ¬¡ã¯ã€LINEã®ã‚°ãƒ«ãƒ¼ãƒ—ã«æŠ•ç¨¿ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### LINE Notifyã«ç™»éŒ²ã—ã¦ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹
[LINE Notify](https://notify-bot.line.me/ja/)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¾ã—ã‚‡ã†ã€‚

![LINE Notify API Document](/media/2020/6/17/2020_6_17__7.png)

å³ä¸Šã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’æŠ¼ã—ã¦ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚ã‚¹ãƒãƒ›ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨åŒã˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

ãã®å¾Œã€å³ä¸Šã®ãƒ­ã‚°ã‚¤ãƒ³ã®ã¨ã“ã‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚[ãƒ¦ãƒ¼ã‚¶ãƒ¼å > ãƒã‚¤ãƒšãƒ¼ã‚¸]ã«é·ç§»ã—ã€ãƒšãƒ¼ã‚¸æœ€ä¸‹éƒ¨ã®ã€Œãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![é–‹ç™ºè€…å‘ã‘ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³](/media/2020/6/17/2020_6_17__8.png)

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€šçŸ¥ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠã—ã¦ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ä¸€åº¦ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„ã®ã§è¦æ³¨æ„ã§ã™ã€‚

[Slackã®æ™‚ã¨åŒæ§˜ã«Google Apps Scriptã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ã—ã¾ã™ã€‚](/posts/google-apps-script-api-templates/#google-apps-scriptã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«webhook-urlã‚’ä¿å­˜ã™ã‚‹)

ã“ã“ã§ã¯ã€`LINE_NOTIFY_TOKEN`ã‚’ã‚­ãƒ¼ã«ã—ã¦ã„ã¾ã™ã€‚

### Google Apps Scriptã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
LINE Notifyã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ `https://notify-api.line.me/api/notify` ã«POSTã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã¾ã™ã€‚

```js
const LINE_NOTIFY_TOKEN = PropertiesService
    .getScriptProperties()
    .getProperty('LINE_NOTIFY_TOKEN')
const ENDPOINT = 'https://notify-api.line.me/api/notify'

// æœ¬æ–‡ã‚’çµ„ã¿ç«‹ã¦ã‚‹
function getMessage() {
  return `LINEã«æŠ•ç¨¿ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸`
}

function getPayload() {
  const params = {
    'message': getMessage(),
  }

  let body = [];
  Object.keys(params).map(key => {
    body.push(key + '=' + encodeURI(params[key]));
  })
  return body.join("&")
}

function send() {
  const options = {
    "method": "POST",
    "headers": {
      "Content-Type": "application/x-www-form-urlencoded",
      "Authorization": `Bearer ${LINE_NOTIFY_TOKEN}`,
    },
    "payload": getPayload(),
    "muteHttpExceptions": true
  }

  UrlFetchApp.fetch(ENDPOINT, options);
}
```

Slackã®å ´åˆã¨åŒæ§˜ã«ã€é–¢æ•°`send`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

![LINEã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸](/media/2020/6/17/2020_6_17__9.png)

LINEã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã§ãã¾ã—ãŸ ğŸ‰


## ã¾ã¨ã‚
ä»Šå›ã¯Google Apps Scriptã‚’ä½¿ã£ã¦ã€Slackã¨LINEã«é€šçŸ¥ã‚’é€ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

Google Apps Scriptã‚’ä½¿ã„ã“ãªã—ã¦ã€ä¸Šæ‰‹ã«é€£æºã‚’ä½¿ã„ã“ãªã—ã¾ã—ã‚‡ã†ï¼
